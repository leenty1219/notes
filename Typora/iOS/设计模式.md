
å¿«é€Ÿçš„ä½¿ç”¨åœºæ™¯ä»¥åŠå»ºè®®

| è®¾è®¡æ¨¡å¼ | é€‚ç”¨åœºæ™¯ |
| --- | --- |
| **å•ä¾‹** | å…¨å±€å”¯ä¸€å¯¹è±¡ï¼ˆå¦‚é…ç½®ç®¡ç†ã€æ•°æ®åº“è¿æ¥ã€æ—¥å¿—ç®¡ç†ç­‰ï¼‰ |
| **å·¥å‚æ–¹æ³•** | åˆ›å»ºå¯¹è±¡æ—¶éœ€è¦çµæ´»æ‰©å±•å…·ä½“ç±»ï¼Œä¸”å®¢æˆ·ç«¯åªä¾èµ–æŠ½è±¡æ¥å£ ï¼Œ`æ ¹æ®ä¸åŒçš„æšä¸¾åˆ›å»ºå­ç±»/æ— é™æ´¾ç”Ÿå­ç±»` |
| **æŠ½è±¡å·¥å‚** | éœ€è¦åˆ›å»ºä¸€ç³»åˆ—ç›¸å…³æˆ–ç›¸äº’ä¾èµ–çš„å¯¹è±¡æ—ï¼Œä¸”æ— éœ€æŒ‡å®šå…·ä½“ç±» `å°†å·¥å‚å’Œäº§å“éƒ½æŠ½è±¡åŒ–` |
| **å»ºé€ è€…** | å¤æ‚å¯¹è±¡çš„åˆ†æ­¥æ„é€ ï¼Œä¸”æ„é€ è¿‡ç¨‹ç¨³å®šä½†è¡¨ç¤ºå¯å˜ï¼ˆå¦‚æ„å»ºå¤æ‚UIã€ç½‘ç»œè¯·æ±‚å‚æ•°ï¼‰`åˆ†é…æ„é€ ï¼Œå…¶ä½™é»˜è®¤å‚æ•°` |
| **åŸå‹** | éœ€è¦é€šè¿‡æ‹·è´å·²æœ‰å®ä¾‹åˆ›å»ºå¯¹è±¡ï¼Œé¿å…é‡å¤æ„é€ ï¼Œä¸”å¯¹è±¡åˆ›å»ºæˆæœ¬é«˜ `æ‹·è´éƒ¨åˆ†ï¼Œæ³¨æ„è¦åˆ›å»ºæˆæœ¬é«˜` |
| **é€‚é…å™¨** | éœ€è¦å°†ä¸€ä¸ªç±»çš„æ¥å£è½¬æ¢æˆå®¢æˆ·å¸Œæœ›çš„å¦ä¸€ä¸ªæ¥å£ï¼Œè§£å†³æ¥å£ä¸å…¼å®¹é—®é¢˜ `æ·»åŠ ä¸€å±‚åŒ…è£…ï¼Œæ›´ç¬¦åˆæ•´ä½“` |
| **æ¡¥æ¥** | æŠ½è±¡ä¸å®ç°åˆ†ç¦»ï¼Œå¯ç‹¬ç«‹å˜åŒ–ï¼›å¤šç»´åº¦å˜åŒ–è§£è€¦ï¼Œå‡å°‘å­ç±»çˆ†ç‚¸ã€‚`æ›´è§£è€¦ï¼Œæ›´æŠ½è±¡` |
| **è£…é¥°å™¨** | éœ€è¦åŠ¨æ€æ‰©å±•å¯¹è±¡åŠŸèƒ½ï¼Œæ›¿ä»£å­ç±»ç»§æ‰¿ï¼Œé¿å…ç±»çˆ†ç‚¸ã€‚`ä¸ºç±»æ‰©å±•æ›´å¤šçš„åŠŸèƒ½` |
| **å¤–è§‚** | ä¸ºå¤æ‚å­ç³»ç»Ÿæä¾›ç®€å•æ¥å£ï¼Œé™ä½è€¦åˆï¼Œæ–¹ä¾¿è°ƒç”¨ã€‚`å°è£…å•ä¸ªè°ƒç”¨ä¸€å †ï¼Œå¦‚ç”¨Configç±»æ¥åŠ è½½æ—¥å¿—ã€å´©æºƒç›‘æµ‹` |
| **ç»„åˆ** | å¯¹è±¡æ ‘å½¢ç»“æ„çš„è¡¨ç¤ºï¼Œç»Ÿä¸€å¯¹å¾…å•ä¸ªå¯¹è±¡å’Œç»„åˆå¯¹è±¡ã€‚`UIViewå’ŒSubViews` |
| **äº«å…ƒ** | ç³»ç»Ÿä¸­å­˜åœ¨å¤§é‡ç›¸ä¼¼å¯¹è±¡ï¼Œä¸”å¯å…±äº«ç›¸åŒéƒ¨åˆ†çŠ¶æ€ï¼ŒèŠ‚çº¦å†…å­˜ `UITableViewCell é‡ç”¨` |
| **ä»£ç†** | æ§åˆ¶å¯¹çœŸå®å¯¹è±¡çš„è®¿é—®ï¼ˆè¿œç¨‹ã€å»¶è¿ŸåŠ è½½ã€æƒé™æ§åˆ¶ç­‰ï¼‰ |
| **è´£ä»»é“¾** | å¤šä¸ªå¯¹è±¡å¯å¤„ç†è¯·æ±‚ï¼ŒæŒ‰é“¾å¼ä¼ é€’è¯·æ±‚ï¼Œé¿å…è¯·æ±‚å‘é€è€…å’Œæ¥æ”¶è€…è€¦åˆ.`å¦‚è¯·å‡æµç¨‹æœ¬çº§å¤„ç†å®Œæˆï¼Œä¸¢ç»™ä¸‹ä¸€çº§ã€‚GPUImage` |
| **å‘½ä»¤** | è¯·æ±‚å°è£…æˆå¯¹è±¡ï¼Œæ”¯æŒè¯·æ±‚æ’é˜Ÿã€æ—¥å¿—ã€æ’¤é”€ç­‰ |
| **è§£é‡Šå™¨** | å®ç°ç‰¹å®šè¯­è¨€çš„è§£æä¸æ‰§è¡Œï¼Œè¯­æ³•è§„åˆ™å°è£…ä¸ºç±» |
| **è¿­ä»£å™¨** | é¡ºåºè®¿é—®èšåˆå¯¹è±¡å…ƒç´ ï¼Œè€Œä¸æš´éœ²å…¶å†…éƒ¨è¡¨ç¤º |
| **ä¸­ä»‹è€…** | å¤æ‚å¯¹è±¡ä¹‹é—´äº¤äº’é›†ä¸­ç®¡ç†ï¼Œé™ä½å¯¹è±¡é—´è€¦åˆã€‚`å¦‚èŠå¤©å®¤ï¼Œå’Œç¾¤å‹å±äºæœ‰å…³ç³»ï¼Œä½†æˆ‘ä»¬åº”å’ŒèŠå¤©å®¤äº¤äº’` |
| **å¤‡å¿˜å½•** | *éœ€è¦ä¿å­˜å’Œæ¢å¤å¯¹è±¡çŠ¶æ€ï¼Œå®ç°æ’¤é”€åŠŸèƒ½* |
| **è§‚å¯Ÿè€…** | ä¸€å¯¹å¤šä¾èµ–å…³ç³»ï¼ŒçŠ¶æ€å˜åŒ–è‡ªåŠ¨é€šçŸ¥è§‚å¯Ÿè€… |
| **çŠ¶æ€** | å¯¹è±¡è¡Œä¸ºä¾èµ–çŠ¶æ€ï¼ŒçŠ¶æ€æ”¹å˜å½±å“è¡Œä¸ºï¼Œå®ç°çŠ¶æ€åˆ‡æ¢ã€‚`å¦‚æ’­æ”¾å™¨åˆ°å¤šç§çŠ¶æ€ï¼Œç”±contaxtè®°å½•å½“å‰çŠ¶æ€æ¥å¤„ç†æ“ä½œ` |
| **ç­–ç•¥** | å®šä¹‰ä¸€ç³»åˆ—ç®—æ³•ï¼Œå®¢æˆ·ç«¯å¯**åŠ¨æ€åˆ‡æ¢ç®—æ³•ã€‚**`å¦‚æ”¯æŒå¤šç§æ”¯ä»˜æ–¹å¼ï¼ŒæŸä¸€ç§å¤±è´¥åŠ¨æ€åˆ‡æ¢åˆ°å¦å¤–ä¸€ç§` |
| **æ¨¡æ¿æ–¹æ³•** | å®šä¹‰ç®—æ³•éª¨æ¶ï¼Œéƒ¨åˆ†æ­¥éª¤ç”±å­ç±»å®ç°ï¼Œå¤ç”¨ä¸å˜æµç¨‹ï¼Œ`å¦‚UIViewControllerçš„viewDidLoad` |
| **è®¿é—®è€…** | æ•°æ®ç»“æ„ç¨³å®šï¼Œéœ€è¦å¯¹ç»“æ„ä¸­çš„å…ƒç´ æ‰§è¡Œä¸åŒæ“ä½œï¼Œæ“ä½œæ˜“æ‰©å±• |

# 1. åˆ›å»ºå‹æ¨¡å¼

## 1.1 å•ä¾‹æ¨¡å¼

```swift
class AppManager {
    static let shared = AppManager()
    private init() {}
}
```

## 1.2 å·¥å‚æ¨¡å¼

1.**ç®€å•å·¥å‚**ï¼šä½¿ç”¨æšä¸¾æ¥è¿”å›ç±»å‹ã€‚æ–°å¢ä¸€ä¸ªç±»å‹æ—¶ï¼Œéœ€è¦æ‰©å±•æšä¸¾ã€æ–°å¢ç±»

2.**å·¥å‚æ¨¡å¼**ï¼šæ¯ä¸€ä¸ªäº§å“ä¸€ä¸ªç±»å‹ã€‚

```swift
/// ç®€å•å·¥å‚ï¼Œä½¿ç”¨switchæ¥è¿”å›éœ€è¦å“ªä¸ªç±»ã€‚æ‰©å±•æ€§ç¨å·®
enum ProductType {
    case a
    case b
}

class SimpleFactory {
    static func makeProduct(type: ProductType) -> Product {
        switch type {
        case .a: return ProductA()
        case .b: return ProductB()
        }
    }
}

protocol Product {
    func use()
}

class ProductA: Product {
    func use() { print("Using product A") }
}

class ProductB: Product {
    func use() { print("Using product B") }
}
/// å·¥å‚æ¨¡å¼

class ViewController: UIViewController {

    override func viewDidLoad() {
        super.viewDidLoad()
        
        view.backgroundColor = .white
        
        let a = FactoryA()
        a.makeProduct()
        
        let b = FactoryB()
        b.makeProduct()
        
    }
}
protocol Factory {
    func makeProduct();
}

class FactoryA : Factory {
    func makeProduct() {
        print("make product A")
    }
}

class FactoryB : Factory {
    func makeProduct() {
        print("make product B")
    }
}
```

## 1.3 æŠ½è±¡å·¥å‚

åˆ›å»ºä¸€ç»„ç›¸å…³å¯¹è±¡

```swift
// æŠ½è±¡äº§å“
protocol Button {
    func render()
}

protocol Label {
    func show()
}

// æŠ½è±¡å·¥å‚
protocol GUIFactory {
    func createButton() -> Button
    func createLabel() -> Label
}

// å…·ä½“äº§å“ A
class iOSButton: Button {
    func render() { print("Render iOS Button") }
}
class iOSLabel: Label {
    func show() { print("Show iOS Label") }
}

// å…·ä½“äº§å“ B
class AndroidButton: Button {
    func render() { print("Render Android Button") }
}
class AndroidLabel: Label {
    func show() { print("Show Android Label") }
}

// å…·ä½“å·¥å‚ A
class iOSFactory: GUIFactory {
    func createButton() -> Button { iOSButton() }
    func createLabel() -> Label { iOSLabel() }
}

// å…·ä½“å·¥å‚ B
class AndroidFactory: GUIFactory {
    func createButton() -> Button { AndroidButton() }
    func createLabel() -> Label { AndroidLabel() }
}
```

## 1.4 å»ºé€ è€…æ¨¡å¼

- å¯¹è±¡æ„å»ºè¿‡ç¨‹å¤æ‚ï¼Œæ­¥éª¤å¤šï¼ˆæ¯”å¦‚ `NSAttributedString`ï¼Œ`NSMutableURLRequest`ï¼‰
- æƒ³è¦é“¾å¼è°ƒç”¨æé«˜å¯è¯»æ€§
- æƒ³æ„é€ ä¸åŒç±»å‹æˆ–æ ·å¼çš„å¯¹è±¡ï¼Œä½†æ„å»ºè¿‡ç¨‹ç±»ä¼¼

é€šè¿‡åˆ›å»ºä¸€ä¸ªæ„é€ å™¨ï¼Œæ¥åˆ†æ­¥éª¤æ„å»ºå¤æ‚å¯¹è±¡ã€‚

```swift
// äº§å“ç±»--è¦æ„é€ çš„å¯¹è±¡
class CustomView {
    var backgroundColor: UIColor?
    var cornerRadius: CGFloat = 0
    var borderWidth: CGFloat = 0
    var borderColor: UIColor?

    func showConfig() {
        print("èƒŒæ™¯è‰²ï¼š\(backgroundColor?.description ?? "nil")ï¼Œåœ†è§’ï¼š\(cornerRadius)ï¼Œè¾¹æ¡†ï¼š\(borderWidth)ï¼Œè¾¹æ¡†é¢œè‰²ï¼š\(borderColor?.description ?? "nil")")
    }
}
// åˆ›å»ºæ„é€ å™¨
class CustomViewBuilder {
    private var view = CustomView()
    
    func setBackgroundColor(_ color: UIColor) -> CustomViewBuilder {
        view.backgroundColor = color
        return self
    }
    
    func setCornerRadius(_ radius: CGFloat) -> CustomViewBuilder {
        view.cornerRadius = radius
        return self
    }
    
    func setBorder(width: CGFloat, color: UIColor) -> CustomViewBuilder {
        view.borderWidth = width
        view.borderColor = color
        return self
    }
    
    func build() -> CustomView {
        return view
    }
}
let myView = CustomViewBuilder()
    .setBackgroundColor(.blue)
    .setCornerRadius(8)
    .setBorder(width: 1, color: .gray)
    .build()

myView.showConfig()
// è¾“å‡ºï¼šèƒŒæ™¯è‰²ï¼šUIDeviceRGBColorSpace 0 0 1 1ï¼Œåœ†è§’ï¼š8.0ï¼Œè¾¹æ¡†ï¼š1.0ï¼Œè¾¹æ¡†é¢œè‰²ï¼šUIDeviceWhiteColorSpace 0.5 1

```

## 1.5 åŸå‹æ¨¡å¼

- åˆ›å»ºå¯¹è±¡çš„æˆæœ¬æ¯”è¾ƒé«˜ï¼ˆåˆå§‹åŒ–è€—æ—¶æˆ–è¿‡ç¨‹å¤æ‚ï¼‰
- ä½ å¸Œæœ›å¤åˆ¶çš„å¯¹è±¡åŒ…å«å½“å‰æ‰€æœ‰çŠ¶æ€
- å¸Œæœ›é¿å…æ„é€ å‡½æ•°ä¸­çš„é€»è¾‘æ‰§è¡Œ

```swift
class Document: NSCopying {
    var text: String
    var images: [String]
    
    init(text: String, images: [String]) {
        self.text = text
        self.images = images
    }
    
    func copy(with zone: NSZone? = nil) -> Any {
        let copy = Document(text: self.text, images: self.images)
        return copy
    }
    
    func show() {
        print("æ–‡æœ¬ï¼š\(text)ï¼Œå›¾ç‰‡ï¼š\(images)")
    }
}
```

# 2. ç»“æ„æ€§æ¨¡å¼

## 2.1 é€‚é…å™¨æ¨¡å¼

é€‚é…å™¨æ¨¡å¼ï¼ˆ**Adapter Pattern**ï¼‰æ˜¯ç»“æ„å‹è®¾è®¡æ¨¡å¼çš„ä¸€ç§ï¼Œ**ç”¨äºå°†ä¸€ä¸ªç±»çš„æ¥å£è½¬æ¢æˆå®¢æˆ·ç«¯æœŸæœ›çš„å¦ä¸€ä¸ªæ¥å£**ã€‚å®ƒå°±åƒç”µæºæ’å¤´çš„â€œè½¬æ¢å™¨â€ â€”â€” è®©æœ¬æ¥ä¸å…¼å®¹çš„æ¥å£èƒ½å¤ŸååŒå·¥ä½œã€‚

- å·²æœ‰ç³»ç»Ÿä¸­çš„ç±»æ¥å£ä¸ç¬¦åˆæ–°çš„å®¢æˆ·ç«¯éœ€æ±‚
- ä½ æƒ³å¤ç”¨ä¸€äº›æ—§ç±»ï¼Œä½†åˆä¸æƒ³æ”¹åŠ¨å®ƒä»¬
- ä½ åœ¨ç”¨ç¬¬ä¸‰æ–¹åº“ï¼Œä½†æ¥å£ä¸å‹å¥½

```swift
// æ—§çš„åŠŸèƒ½åªèƒ½æ’­æ”¾mp3
class MP3Player {
    func playMP3(fileName: String) {
        print("æ’­æ”¾ MP3 æ–‡ä»¶: \(fileName)")
    }
}
protocol AudioPlayer {
    func play(fileName: String)
}
class MP3Adapter: AudioPlayer {
    private let mp3Player = MP3Player()
    
    func play(fileName: String) {
        if fileName.hasSuffix(".mp3") {
            mp3Player.playMP3(fileName: fileName)
        } else {
            print("æ— æ³•æ’­æ”¾æ­¤æ ¼å¼: \(fileName)")
        }
    }
}
/// ä½¿ç”¨åœºæ™¯
let player: AudioPlayer = MP3Adapter()
player.play(fileName: "music.mp3")
player.play(fileName: "song.flac")
```

## 2.2 æ¡¥æ¥æ¨¡å¼

å°†æŠ½è±¡éƒ¨åˆ†ä¸å®ƒçš„å®ç°éƒ¨åˆ†åˆ†ç¦»ï¼Œä½¿å®ƒä»¬éƒ½å¯ä»¥ç‹¬ç«‹åœ°å˜åŒ–ã€‚

æ¡¥æ¥æ¨¡å¼å’Œé€‚é…å™¨ä¸åŒã€‚é€‚é…å™¨æ˜¯**å…¼å®¹å·²æœ‰æ¥å£**ï¼Œè€Œæ¡¥æ¥æ¨¡å¼æ˜¯**ä¸»åŠ¨è®¾è®¡æ¥å£åˆ†ç¦»ï¼Œé¢å‘æ‰©å±•**ã€‚

```swift
// å®ç°éƒ¨åˆ†
protocol Renderer {
    func renderCircle(radius: Double)
}
class MetalRenderer: Renderer {
    func renderCircle(radius: Double) {
        print("Using Metal to render a circle with radius \(radius)")
    }
}

class OpenGLRenderer: Renderer {
    func renderCircle(radius: Double) {
        print("Using OpenGL to render a circle with radius \(radius)")
    }
}
class Shape {
    let renderer: Renderer
    init(renderer: Renderer) {
        self.renderer = renderer
    }
    func draw() {
        // ç•™ç©ºï¼Œç”±å­ç±»å®ç°
    }
}
class Circle: Shape {
    let radius: Double
    init(renderer: Renderer, radius: Double) {
        self.radius = radius
        super.init(renderer: renderer)
    }
    
    override func draw() {
        renderer.renderCircle(radius: radius)
    }
}
// ä½¿ç”¨
let metal = MetalRenderer()
let circle1 = Circle(renderer: metal, radius: 10)
circle1.draw()

let opengl = OpenGLRenderer()
let circle2 = Circle(renderer: opengl, radius: 20)
circle2.draw()

```

## 2.3 è£…é¥°å™¨æ¨¡å¼

è£…é¥°å™¨æ¨¡å¼ï¼ˆ**Decorator Pattern**ï¼‰æ˜¯ç»“æ„å‹è®¾è®¡æ¨¡å¼ä¹‹ä¸€ï¼Œç”¨äº**åœ¨ä¸ä¿®æ”¹åŸå§‹å¯¹è±¡çš„å‰æä¸‹ï¼ŒåŠ¨æ€åœ°æ‰©å±•å…¶åŠŸèƒ½**

```swift
protocol Text {
    func display() -> String
}
class PlainText: Text {
    private let content: String

    init(_ content: String) {
        self.content = content
    }

    func display() -> String {
        return content
    }
}
class TextDecorator: Text {
    private let wrapped: Text

    init(_ wrapped: Text) {
        self.wrapped = wrapped
    }

    func display() -> String {
        return wrapped.display()
    }
}
class BoldText: TextDecorator {
    override func display() -> String {
        return "<b>" + super.display() + "</b>"
    }
}

class UnderlineText: TextDecorator {
    override func display() -> String {
        return "<u>" + super.display() + "</u>"
    }
}

class RedText: TextDecorator {
    override func display() -> String {
        return "<font color='red'>" + super.display() + "</font>"
    }
}
// ä½¿ç”¨
let text = PlainText("Hello")
let bold = BoldText(text)
let underline = UnderlineText(bold)
let red = RedText(underline)

print(red.display())

```

## 2.4 å¤–è§‚æ¨¡å¼

å°è£…å¤æ‚å­ç³»ç»Ÿã€æä¾›ç»Ÿä¸€å…¥å£ã€è§£è€¦å®¢æˆ·ç«¯ä¸å­ç³»ç»Ÿä¹‹é—´çš„ä¾èµ–å…³ç³»

```swift
class ConfigManager {
    func loadConfig() {
        print("é…ç½®å·²åŠ è½½")
    }
}

class LogManager {
    func setupLogger() {
        print("æ—¥å¿—ç³»ç»Ÿå·²åˆå§‹åŒ–")
    }
}

class NetworkManager {
    func setupNetwork() {
        print("ç½‘ç»œç³»ç»Ÿå·²å‡†å¤‡")
    }
}

class UserManager {
    func checkLoginStatus() {
        print("ç”¨æˆ·ç™»å½•çŠ¶æ€å·²æ£€æŸ¥")
    }
}
class AppFacade {
    private let config = ConfigManager()
    private let logger = LogManager()
    private let network = NetworkManager()
    private let user = UserManager()
    
    func initializeApp() {
        config.loadConfig()
        logger.setupLogger()
        network.setupNetwork()
        user.checkLoginStatus()
    }
}
// ä½¿ç”¨
let app = AppFacade()
app.initializeApp()
```

## 2.5 ç»„åˆæ¨¡å¼

ç»„åˆæ¨¡å¼ï¼ˆ**Composite Pattern**ï¼‰æ˜¯ä¸€ç§ç»“æ„å‹è®¾è®¡æ¨¡å¼ï¼Œç”¨äºå°†å¯¹è±¡ç»„åˆæˆæ ‘å½¢ç»“æ„ä»¥è¡¨ç¤ºâ€œ**éƒ¨åˆ†-æ•´ä½“**â€çš„å±‚æ¬¡ç»“æ„ã€‚

å®ƒä½¿å¾—å®¢æˆ·ç«¯å¯¹å•ä¸ªå¯¹è±¡å’Œç»„åˆå¯¹è±¡å…·æœ‰**ä¸€è‡´çš„è®¿é—®æ–¹å¼**ã€‚

egã€‚æ‰€æœ‰è§†å›¾éƒ½ç»§æ‰¿è‡ª `UIView`ï¼Œä½ å¯ä»¥å¯¹ `rootView` è¿›è¡Œç»Ÿä¸€æ“ä½œï¼Œè€Œä¸ç®¡å®ƒå†…éƒ¨æœ‰å¤šå°‘å­è§†å›¾ï¼Œè¿™å°±æ˜¯ç»„åˆæ¨¡å¼ã€‚

```swift
let rootView = UIView()
let button = UIButton()
let label = UILabel()
rootView.addSubview(button)
rootView.addSubview(label)
```

```swift
protocol Employee {
    func showDetails()
}
class Developer: Employee {
    private let name: String
    init(name: String) {
        self.name = name
    }

    func showDetails() {
        print("å¼€å‘äººå‘˜: \(name)")
    }
}
class Manager: Employee {
    private let name: String
    private var subordinates: [Employee] = []

    init(name: String) {
        self.name = name
    }

    func addSubordinate(_ employee: Employee) {
        subordinates.append(employee)
    }

    func showDetails() {
        print("ç»ç†: \(name)")
        for employee in subordinates {
            employee.showDetails()
        }
    }
}
// ä½¿ç”¨
let dev1 = Developer(name: "Alice")
let dev2 = Developer(name: "Bob")

let teamLead = Manager(name: "Charlie")
teamLead.addSubordinate(dev1)
teamLead.addSubordinate(dev2)

let cto = Manager(name: "Diana")
cto.addSubordinate(teamLead)

cto.showDetails()
```

## 2.6 äº«å…ƒæ¨¡å¼

å…±äº«å¯¹è±¡é™ä½å†…å­˜ï¼Œå¦‚`UITableViewCell`

## 2.7 ä»£ç†æ¨¡å¼

/

# 3. è¡Œä¸ºæ¨¡å¼

## 3.1 è´£ä»»é“¾æ¨¡å¼

è´£ä»»é“¾æ¨¡å¼ï¼ˆ**Chain of Responsibility Pattern**ï¼‰æ˜¯ä¸€ç§**è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼**ï¼Œå®ƒä½¿å¤šä¸ªå¯¹è±¡éƒ½æœ‰æœºä¼šå¤„ç†è¯·æ±‚ï¼Œä»è€Œé¿å…è¯·æ±‚çš„å‘é€è€…å’Œæ¥æ”¶è€…ä¹‹é—´çš„è€¦åˆå…³ç³»ã€‚å°†è¿™äº›å¯¹è±¡è¿æˆä¸€æ¡é“¾ï¼Œå¹¶æ²¿ç€è¿™æ¡é“¾ä¼ é€’è¯·æ±‚ï¼Œç›´åˆ°æœ‰ä¸€ä¸ªå¯¹è±¡å¤„ç†å®ƒä¸ºæ­¢ã€‚

- **å°†è¯·æ±‚æ²¿ç€å¤„ç†é“¾ä¼ é€’**
- æ¯ä¸ªèŠ‚ç‚¹å¯ä»¥ï¼š
    - **å¤„ç†è¯·æ±‚**
    - **å°†è¯·æ±‚ä¼ é€’ç»™ä¸‹ä¸€ä¸ªèŠ‚ç‚¹**

ç±»ä¼¼UIViewçš„äº‹ä»¶å“åº”é“¾

```swift
/// å®šä¹‰å½“å‰èŠ‚ç‚¹
class LeaveRequest {
    let name: String
    let days: Int

    init(name: String, days: Int) {
        self.name = name
        self.days = days
    }
}
/// åè®®ï¼Œèƒ½å¤Ÿè®¿é—®åˆ°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹
protocol LeaveHandler {
    var next: LeaveHandler? { get set }
    func handle(request: LeaveRequest)
}
class TeamLead: LeaveHandler {
    var next: LeaveHandler?

    func handle(request: LeaveRequest) {
        if request.days <= 2 {
            print("TeamLead æ‰¹å‡† \(request.name) è¯·å‡ \(request.days) å¤©")
        } else {
            next?.handle(request: request)
        }
    }
}

class Manager: LeaveHandler {
    var next: LeaveHandler?

    func handle(request: LeaveRequest) {
        if request.days <= 5 {
            print("Manager æ‰¹å‡† \(request.name) è¯·å‡ \(request.days) å¤©")
        } else {
            next?.handle(request: request)
        }
    }
}

class CEO: LeaveHandler {
    var next: LeaveHandler?

    func handle(request: LeaveRequest) {
        print("CEO æ‰¹å‡† \(request.name) è¯·å‡ \(request.days) å¤©")
    }
}
/// ä½¿ç”¨
let teamLead = TeamLead()
let manager = Manager()
let ceo = CEO()

teamLead.next = manager
manager.next = ceo

let request1 = LeaveRequest(name: "Tom", days: 1)
let request2 = LeaveRequest(name: "Jerry", days: 4)
let request3 = LeaveRequest(name: "Bob", days: 10)

teamLead.handle(request: request1)
teamLead.handle(request: request2)
teamLead.handle(request: request3)
// è¾“å‡ºæ‰“å°
/*
TeamLead æ‰¹å‡† Tom è¯·å‡ 1 å¤©
Manager æ‰¹å‡† Jerry è¯·å‡ 4 å¤©
CEO æ‰¹å‡† Bob è¯·å‡ 10 å¤©
*/
```

## 3.2 å‘½ä»¤æ¨¡å¼

å‘½ä»¤æ¨¡å¼ï¼ˆ**Command Pattern**ï¼‰æ˜¯ä¸€ç§**è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼**ï¼Œå®ƒå°†**è¯·æ±‚å°è£…æˆå¯¹è±¡**ï¼Œä»è€Œå…è®¸ä½ **å°†è¯·æ±‚å‚æ•°åŒ–ã€æ’é˜Ÿã€è®°å½•æ—¥å¿—**ï¼Œå¹¶æ”¯æŒ**æ’¤é”€æ“ä½œ**ç­‰ã€‚

```swift
// å®šä¹‰å‘½ä»¤åè®®
protocol Command {
    func execute()
    func undo()
}
// æ¥æ”¶è€…ï¼ˆæ‰§è¡Œå…·ä½“é€»è¾‘çš„å¯¹è±¡ï¼‰
class Light {
    func turnOn() {
        print("ğŸ’¡ Light is ON")
    }

    func turnOff() {
        print("ğŸ’¡ Light is OFF")
    }
}
//å…·ä½“å‘½ä»¤ç±»
class LightOnCommand: Command {
    private let light: Light

    init(light: Light) {
        self.light = light
    }

    func execute() {
        light.turnOn()
    }

    func undo() {
        light.turnOff()
    }
}

class LightOffCommand: Command {
    private let light: Light

    init(light: Light) {
        self.light = light
    }

    func execute() {
        light.turnOff()
    }

    func undo() {
        light.turnOn()
    }
}
//  è°ƒç”¨è€…ï¼ˆé¥æ§å™¨ï¼‰
class RemoteControl {
    private var command: Command?
    private var history: [Command] = []

    func setCommand(_ command: Command) {
        self.command = command
    }

    func pressButton() {
        command?.execute()
        if let cmd = command {
            history.append(cmd)
        }
    }

    func pressUndo() {
        guard let last = history.popLast() else { return }
        last.undo()
    }
}
/// ä½¿ç”¨ç¤ºä¾‹
let light = Light()
let lightOn = LightOnCommand(light: light)
let lightOff = LightOffCommand(light: light)

let remote = RemoteControl()

remote.setCommand(lightOn)
remote.pressButton()     // ğŸ’¡ Light is ON

remote.setCommand(lightOff)
remote.pressButton()     // ğŸ’¡ Light is OFF

remote.pressUndo()       // ğŸ’¡ Light is ON
```

## 3.3 è§£é‡Šå™¨æ¨¡å¼

è§£é‡Šå™¨æ¨¡å¼ï¼ˆ**Interpreter Pattern**ï¼‰æ˜¯ä¸€ç§**è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼**ï¼Œç”¨äº**å®šä¹‰ä¸€ç§è¯­è¨€çš„è¯­æ³•è¡¨ç¤º**ï¼Œå¹¶**æ„å»ºä¸€ä¸ªè§£é‡Šå™¨**æ¥è§£é‡Šæˆ–æ‰§è¡Œè¯¥è¯­è¨€ä¸­çš„å¥å­

```swift
protocol Expression {
    func interpret(context: [String: Bool]) -> Bool
}
//  å®ç°ç»ˆç»“ç¬¦è¡¨è¾¾å¼ï¼ˆå˜é‡ï¼‰
class VariableExpression: Expression {
    private let name: String

    init(_ name: String) {
        self.name = name
    }

    func interpret(context: [String: Bool]) -> Bool {
        return context[name] ?? false
    }
}
// å®ç°éç»ˆç»“ç¬¦è¡¨è¾¾å¼ï¼ˆANDã€ORã€NOTï¼‰
class AndExpression: Expression {
    private let left: Expression
    private let right: Expression

    init(_ left: Expression, _ right: Expression) {
        self.left = left
        self.right = right
    }

    func interpret(context: [String: Bool]) -> Bool {
        return left.interpret(context: context) && right.interpret(context: context)
    }
}

class OrExpression: Expression {
    private let left: Expression
    private let right: Expression

    init(_ left: Expression, _ right: Expression) {
        self.left = left
        self.right = right
    }

    func interpret(context: [String: Bool]) -> Bool {
        return left.interpret(context: context) || right.interpret(context: context)
    }
}

class NotExpression: Expression {
    private let expr: Expression

    init(_ expr: Expression) {
        self.expr = expr
    }

    func interpret(context: [String: Bool]) -> Bool {
        return !expr.interpret(context: context)
    }
}
// ä½¿ç”¨ç¤ºä¾‹
// è¡¨è¾¾å¼ï¼š(A AND B) OR (NOT C)

let A = VariableExpression("A")
let B = VariableExpression("B")
let C = VariableExpression("C")

let expr = OrExpression(
    AndExpression(A, B),
    NotExpression(C)
)

let context: [String: Bool] = [
    "A": true,
    "B": false,
    "C": false
]

print(expr.interpret(context: context)) // è¾“å‡º true

```

## 3.4 è¿­ä»£å™¨æ¨¡å¼

è¿­ä»£å™¨æ¨¡å¼ï¼ˆ**Iterator Pattern**ï¼‰æ˜¯ä¸€ç§**è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼**ï¼Œç”¨äºæä¾›ä¸€ç§æ–¹æ³•**é¡ºåºè®¿é—®ä¸€ä¸ªèšåˆå¯¹è±¡ä¸­çš„å…ƒç´ **ï¼Œè€Œ**ä¸æš´éœ²å…¶å†…éƒ¨è¡¨ç¤º**ã€‚

- æƒ³è¦éå†é›†åˆç±»ï¼ˆæ•°ç»„ã€é“¾è¡¨ã€è‡ªå®šä¹‰å®¹å™¨ï¼‰ï¼›
- ä¸å¸Œæœ›è®©è°ƒç”¨è€…çŸ¥é“é›†åˆçš„å†…éƒ¨ç»“æ„ï¼ˆå°è£…æ€§ï¼‰ï¼›
- éœ€è¦å¤šä¸ªéå†æ–¹å¼æˆ–å¹¶å‘éå†ã€‚

åœ¨ Swift ä¸­ï¼Œæ ‡å‡†åº“å·²ç»å¤§é‡ä½¿ç”¨äº†è¿­ä»£å™¨æ¨¡å¼ï¼Œæ¯”å¦‚ `Array`ã€`Set`ã€`Dictionary` éƒ½éµå¾ªäº† `Sequence` å’Œ `IteratorProtocol`ã€‚

```swift
protocol Iterator {
    associatedtype Element
    func hasNext() -> Bool
    func next() -> Element?
}
// è‡ªå®šä¹‰èšåˆç±»
class BookShelf {
    private var books: [String] = []

    func append(book: String) {
        books.append(book)
    }

    func bookAt(index: Int) -> String {
        return books[index]
    }

    func count() -> Int {
        return books.count
    }

    func makeIterator() -> BookShelfIterator {
        return BookShelfIterator(self)
    }
}
// å…·ä½“è¿­ä»£å™¨çš„å®ç°
class BookShelfIterator: Iterator {
    private let bookShelf: BookShelf
    private var index = 0

    init(_ bookShelf: BookShelf) {
        self.bookShelf = bookShelf
    }

    func hasNext() -> Bool {
        return index < bookShelf.count()
    }

    func next() -> String? {
        guard hasNext() else { return nil }
        let book = bookShelf.bookAt(index: index)
        index += 1
        return book
    }
}
// ä½¿ç”¨ç¤ºä¾‹
let shelf = BookShelf()
shelf.append(book: "Design Patterns")
shelf.append(book: "Refactoring")
shelf.append(book: "Clean Code")

let iterator = shelf.makeIterator()
while iterator.hasNext() {
    print(iterator.next()!)
}
// è¾“å‡ºï¼š
// Design Patterns
// Refactoring
// Clean Code

```

## 3.5 ä¸­ä»‹è€…æ¨¡å¼

ä¸­ä»‹è€…æ¨¡å¼ï¼ˆ**Mediator Pattern**ï¼‰æ˜¯ä¸€ç§**è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼**ï¼Œç”¨äº**å°è£…å¯¹è±¡ä¹‹é—´çš„äº¤äº’è¡Œä¸º**ï¼Œä½¿å¤šä¸ªå¯¹è±¡ä¸å¿…æ˜¾å¼ç›¸äº’å¼•ç”¨ï¼Œä»è€Œä½¿è€¦åˆæ¾æ•£ã€äº¤äº’é›†ä¸­ã€‚

å°†å¯¹è±¡ä¹‹é—´çš„äº¤äº’é€»è¾‘é›†ä¸­åˆ°ä¸€ä¸ªä¸­ä»‹è€…ä¸­ï¼Œè®©å„ä¸ªå¯¹è±¡ä¸å†ç›´æ¥å¼•ç”¨å½¼æ­¤ï¼Œè€Œæ˜¯é€šè¿‡ä¸­ä»‹è€…åè°ƒé€šä¿¡ã€‚

```markdown
             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚   Mediator   â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â””â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
                   â”‚                       â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ ConcreteColleagueA  â”‚  â”‚ ConcreteColleagueB  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚                       â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚ ConcreteMediatorâ”‚â”€â”€â”€â”€â–¶â”‚åè°ƒå…·ä½“é€šä¿¡é€»è¾‘ â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- å¤šä¸ªå¯¹è±¡ä¹‹é—´å­˜åœ¨å¤æ‚çš„äº¤äº’ï¼Œä¸”å¯¹è±¡ä¹‹é—´ç›¸äº’å¼•ç”¨ï¼›
- å¸Œæœ›å°†äº¤äº’è¡Œä¸ºé›†ä¸­ç®¡ç†ï¼Œé¿å…å¯¹è±¡ä¹‹é—´ç½‘çŠ¶å¼•ç”¨ï¼ˆè§£è€¦ï¼‰ï¼›
- å¸¸ç”¨äºèŠå¤©ç³»ç»Ÿã€è¡¨å•äº¤äº’ã€ç»„ä»¶é€šä¿¡ç­‰åœºæ™¯ã€‚

```swift
// å®šä¹‰ä¸­ä»‹åè®®(èŠå¤©å®¤åŠŸèƒ½)
protocol ChatMediator {
    func send(message: String, from user: User)
    func addUser(_ user: User)
}
// åœ¨å®šä¹‰ç”¨æˆ·ç±»
class User {
    let name: String
    private let mediator: ChatMediator

    init(name: String, mediator: ChatMediator) {
        self.name = name
        self.mediator = mediator
    }

    func send(message: String) {
        print("[\(name)] å‘é€æ¶ˆæ¯ï¼š\(message)")
        mediator.send(message: message, from: self)
    }

    func receive(message: String, from sender: String) {
        print("[\(name)] æ”¶åˆ°æ¥è‡ª [\(sender)] çš„æ¶ˆæ¯ï¼š\(message)")
    }
}
// å®ç°ä¸­ä»‹è€…
class ChatRoomMediator: ChatMediator {
    private var users: [User] = []

    func addUser(_ user: User) {
        users.append(user)
    }

    func send(message: String, from user: User) {
        for u in users where u.name != user.name {
            u.receive(message: message, from: user.name)
        }
    }
}
//ä½¿ç”¨ä¸­ä»‹è€…åè°ƒé€šä¿¡
let mediator = ChatRoomMediator()

let alice = User(name: "Alice", mediator: mediator)
let bob = User(name: "Bob", mediator: mediator)
let charlie = User(name: "Charlie", mediator: mediator)

mediator.addUser(alice)
mediator.addUser(bob)
mediator.addUser(charlie)

alice.send(message: "Hi everyone!")
bob.send(message: "Hello Alice!")
/*
[Alice] å‘é€æ¶ˆæ¯ï¼šHi everyone!
[Bob] æ”¶åˆ°æ¥è‡ª [Alice] çš„æ¶ˆæ¯ï¼šHi everyone!
[Charlie] æ”¶åˆ°æ¥è‡ª [Alice] çš„æ¶ˆæ¯ï¼šHi everyone!
[Bob] å‘é€æ¶ˆæ¯ï¼šHello Alice!
[Alice] æ”¶åˆ°æ¥è‡ª [Bob] çš„æ¶ˆæ¯ï¼šHello Alice!
[Charlie] æ”¶åˆ°æ¥è‡ª [Bob] çš„æ¶ˆæ¯ï¼šHello Alice!
*/
```

## 3.6 å¤‡å¿˜å½•æ¨¡å¼

å¤‡å¿˜å½•æ¨¡å¼ï¼ˆ**Memento Pattern**ï¼‰æ˜¯ä¸€ç§**è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼**ï¼Œç”¨äº**ä¿å­˜å¯¹è±¡åœ¨æŸä¸€æ—¶åˆ»çš„çŠ¶æ€**ï¼Œä»¥ä¾¿åœ¨å°†æ¥æ¢å¤åˆ°è¿™ä¸ªçŠ¶æ€ã€‚è¯¥æ¨¡å¼å¸¸ç”¨äºå®ç°â€œæ’¤é”€/æ¢å¤â€åŠŸèƒ½ã€‚

åœ¨ä¸ç ´åå°è£…çš„å‰æä¸‹ï¼Œ**æ•è·å¹¶ä¿å­˜ä¸€ä¸ªå¯¹è±¡çš„å†…éƒ¨çŠ¶æ€**ï¼Œä»¥ä¾¿åœ¨éœ€è¦æ—¶å¯ä»¥æ¢å¤è¯¥çŠ¶æ€ã€‚

```swift
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Originator   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ï¼ˆå‘èµ·è€…ï¼‰      â”‚            â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
       â”‚ createMemento()     â–¼
       â”‚ restore(memento) â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  Memento   â”‚
                          â”‚ï¼ˆå¤‡å¿˜å½•ï¼‰   â”‚
                          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚ Caretaker      â”‚
                      â”‚ï¼ˆè´Ÿè´£äººï¼‰        â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```swift
// å®šä¹‰å¤‡å¿˜å½•ç±»
class TextMemento {
    let state: String
    
    init(state: String) {
        self.state = state
    }
}
//å®šä¹‰ Originatorï¼ˆå‘èµ·è€…ï¼‰
class TextEditor {
    private var content: String = ""
    
    func type(text: String) {
        content += text
    }

    func getContent() -> String {
        return content
    }

    func save() -> TextMemento {
        return TextMemento(state: content)
    }

    func restore(from memento: TextMemento) {
        self.content = memento.state
    }
}
//  å®šä¹‰ Caretakerï¼ˆè´Ÿè´£äººï¼‰
class History {
    private var states: [TextMemento] = []

    func push(_ memento: TextMemento) {
        states.append(memento)
    }

    func pop() -> TextMemento? {
        return states.popLast()
    }
}
// ä½¿ç”¨å¤‡å¿˜å½•å®ç°æ’¤é”€
let editor = TextEditor()
let history = History()

editor.type(text: "Hello, ")
history.push(editor.save())

editor.type(text: "world!")
history.push(editor.save())

editor.type(text: " Goodbye.") // æ²¡ä¿å­˜

print("å½“å‰å†…å®¹ï¼š\(editor.getContent())") // Hello, world! Goodbye.

if let lastState = history.pop() {
    editor.restore(from: lastState)
    print("æ’¤é”€ä¸€æ¬¡åå†…å®¹ï¼š\(editor.getContent())") // Hello, world!
}

if let lastState = history.pop() {
    editor.restore(from: lastState)
    print("æ’¤é”€ä¸¤æ¬¡åå†…å®¹ï¼š\(editor.getContent())") // Hello,
}
```

 **ä¼˜ç‚¹**

- ä¸æš´éœ²å¯¹è±¡å†…éƒ¨çŠ¶æ€ï¼›
- æ¢å¤å¯¹è±¡çŠ¶æ€éå¸¸ç®€å•ï¼›
- æ”¯æŒæ’¤é”€æ“ä½œã€‚

---

**ğŸ§± ç¼ºç‚¹**

- å¦‚æœå¯¹è±¡çŠ¶æ€å¾ˆå¤§ï¼Œé¢‘ç¹ä¿å­˜ä¼šå ç”¨å¤§é‡å†…å­˜ï¼›
- å¤‡å¿˜å½•ç®¡ç†ä¸å¥½ä¼šé€ æˆèµ„æºæ³„æ¼æˆ–è¿‡å¤šå ç”¨ã€‚

## 3.7 è§‚å¯Ÿè€…æ¨¡å¼

## 3.8 çŠ¶æ€æ¨¡å¼

çŠ¶æ€æ¨¡å¼ï¼ˆ**State Pattern**ï¼‰æ˜¯ä¸€ç§è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼ï¼Œå®ƒå…è®¸ä¸€ä¸ªå¯¹è±¡åœ¨å…¶**å†…éƒ¨çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œæ”¹å˜å®ƒçš„è¡Œä¸º**ï¼Œä½¿å¾—å¯¹è±¡çœ‹èµ·æ¥åƒæ˜¯ä¿®æ”¹äº†å®ƒçš„ç±»ä¸€æ ·ã€‚

```swift
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Context    â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ï¼ˆä¸Šä¸‹æ–‡ï¼‰   â”‚         â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
     â”‚setState()       â”‚
     â–¼                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ StateA     â”‚    â”‚ StateB     â”‚
â”‚ï¼ˆå…·ä½“çŠ¶æ€ï¼‰ â”‚    â”‚ï¼ˆå…·ä½“çŠ¶æ€ï¼‰ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â–²                â–²
         â””â”€â”€â”€â”€â”€å®ç°â”€â”€â”€â”€â”€â”€â”€â”˜
              â†‘
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  State     â”‚
         â”‚ï¼ˆçŠ¶æ€æ¥å£ï¼‰ â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```swift
protocol PlayerState {
    func play(context: PlayerContext)
    func pause(context: PlayerContext)
    func stop(context: PlayerContext)
}
/// è½¬æ¢ç±»
class PlayingState: PlayerState {
    func play(context: PlayerContext) {
        print("å·²ç»åœ¨æ’­æ”¾")
    }

    func pause(context: PlayerContext) {
        print("æš‚åœæ’­æ”¾")
        context.state = PausedState()
    }

    func stop(context: PlayerContext) {
        print("åœæ­¢æ’­æ”¾")
        context.state = StoppedState()
    }
}

class PausedState: PlayerState {
    func play(context: PlayerContext) {
        print("ç»§ç»­æ’­æ”¾")
        context.state = PlayingState()
    }

    func pause(context: PlayerContext) {
        print("å·²ç»æš‚åœ")
    }

    func stop(context: PlayerContext) {
        print("åœæ­¢æ’­æ”¾")
        context.state = StoppedState()
    }
}

class StoppedState: PlayerState {
    func play(context: PlayerContext) {
        print("å¼€å§‹æ’­æ”¾")
        context.state = PlayingState()
    }

    func pause(context: PlayerContext) {
        print("ä¸èƒ½æš‚åœï¼Œå½“å‰å·²åœæ­¢")
    }

    func stop(context: PlayerContext) {
        print("å·²ç»åœæ­¢")
    }
}
// å®šä¹‰ä¸Šä¸‹æ–‡
class PlayerContext {
    var state: PlayerState

    init(state: PlayerState) {
        self.state = state
    }

    func play() {
        state.play(context: self)
    }

    func pause() {
        state.pause(context: self)
    }

    func stop() {
        state.stop(context: self)
    }
}
// ä½¿ç”¨ç¤ºä¾‹
let player = PlayerContext(state: StoppedState())

player.play()   // è¾“å‡ºï¼šå¼€å§‹æ’­æ”¾
player.pause()  // è¾“å‡ºï¼šæš‚åœæ’­æ”¾
player.play()   // è¾“å‡ºï¼šç»§ç»­æ’­æ”¾
player.stop()   // è¾“å‡ºï¼šåœæ­¢æ’­æ”¾
player.pause()  // è¾“å‡ºï¼šä¸èƒ½æš‚åœï¼Œå½“å‰å·²åœæ­¢

```

## 3.9 ç­–ç•¥æ¨¡å¼

ç­–ç•¥æ¨¡å¼ï¼ˆ**Strategy Pattern**ï¼‰æ˜¯ä¸€ç§è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼ï¼Œå®ƒå®šä¹‰äº†ä¸€ç³»åˆ—ç®—æ³•ï¼ŒæŠŠå®ƒä»¬ä¸€ä¸ªä¸ªå°è£…èµ·æ¥ï¼Œå¹¶ä¸”ä½¿å®ƒä»¬å¯ä»¥äº’æ¢ä½¿ç”¨ã€‚**ç­–ç•¥æ¨¡å¼è®©ç®—æ³•ç‹¬ç«‹äºä½¿ç”¨å®ƒçš„å®¢æˆ·ç«¯ç‹¬ç«‹å˜åŒ–ã€‚**

åœºæ™¯ï¼šæˆ‘ä»¬éœ€è¦æ”¯æŒä¸åŒæ”¯ä»˜æ–¹å¼ï¼ˆå¾®ä¿¡ã€æ”¯ä»˜å®ã€é“¶è¡Œå¡ï¼‰ï¼Œå¯ä»¥çµæ´»åˆ‡æ¢ã€‚

```swift
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Context    â”‚
â”‚ï¼ˆä¸Šä¸‹æ–‡ï¼‰   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ has-a
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Strategy   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ï¼ˆç­–ç•¥æ¥å£ï¼‰ â”‚         â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
     â”‚                 â”‚
 â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
 â”‚ ConcreteA  â”‚   â”‚ ConcreteB  â”‚
 â”‚ï¼ˆå…·ä½“ç­–ç•¥ï¼‰ â”‚   â”‚ï¼ˆå…·ä½“ç­–ç•¥ï¼‰ â”‚
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```swift
protocol PaymentStrategy {
    func pay(amount: Double)
}
/// å®ç°ä¸åŒçš„ç­–ç•¥
class WeChatPay: PaymentStrategy {
    func pay(amount: Double) {
        print("ä½¿ç”¨å¾®ä¿¡æ”¯ä»˜ \(amount) å…ƒ")
    }
}

class Alipay: PaymentStrategy {
    func pay(amount: Double) {
        print("ä½¿ç”¨æ”¯ä»˜å®æ”¯ä»˜ \(amount) å…ƒ")
    }
}

class BankCardPay: PaymentStrategy {
    func pay(amount: Double) {
        print("ä½¿ç”¨é“¶è¡Œå¡æ”¯ä»˜ \(amount) å…ƒ")
    }
}
/// ä¸Šä¸‹æ–‡ç±»
class PaymentContext {
    private var strategy: PaymentStrategy

    init(strategy: PaymentStrategy) {
        self.strategy = strategy
    }

    func setStrategy(_ strategy: PaymentStrategy) {
        self.strategy = strategy
    }

    func pay(amount: Double) {
        strategy.pay(amount: amount)
    }
}
// ä½¿ç”¨ç¤ºä¾‹
let context = PaymentContext(strategy: WeChatPay())
context.pay(amount: 100.0)   // è¾“å‡ºï¼šä½¿ç”¨å¾®ä¿¡æ”¯ä»˜ 100.0 å…ƒ

context.setStrategy(Alipay())
context.pay(amount: 200.0)   // è¾“å‡ºï¼šä½¿ç”¨æ”¯ä»˜å®æ”¯ä»˜ 200.0 å…ƒ

context.setStrategy(BankCardPay())
context.pay(amount: 300.0)   // è¾“å‡ºï¼šä½¿ç”¨é“¶è¡Œå¡æ”¯ä»˜ 300.0 å…ƒ

```

## 3.10 æ¨¡ç‰ˆæ¨¡å¼

æ¨¡æ¿æ–¹æ³•æ¨¡å¼æ˜¯ä¸€ç§**è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼**ï¼Œå®ƒåœ¨çˆ¶ç±»ä¸­å®šä¹‰ä¸€ä¸ªç®—æ³•çš„**éª¨æ¶**ï¼Œå°†ä¸€äº›æ­¥éª¤çš„å®ç°å»¶è¿Ÿåˆ°å­ç±»ä¸­ã€‚**å­ç±»å¯ä»¥é‡æ–°å®šä¹‰æŸäº›æ­¥éª¤çš„å®ç°ï¼Œè€Œæ— éœ€æ”¹å˜ç®—æ³•çš„ç»“æ„ã€‚**

```swift
class BaseViewController: UIViewController {

    override func viewDidLoad() {
        super.viewDidLoad()
        setupUI()
        bindData()
        fetchData()
    }

    func setupUI() {
        // å­ç±»é‡å†™
    }

    func bindData() {
        // å­ç±»é‡å†™
    }

    func fetchData() {
        // å­ç±»é‡å†™
    }
}
// å­ç±»å®ç°å…·ä½“çš„æ­¥éª¤
class UserViewController: BaseViewController {

    override func setupUI() {
        print("è®¾ç½®ç”¨æˆ·ç•Œé¢")
    }

    override func bindData() {
        print("ç»‘å®šç”¨æˆ·æ•°æ®")
    }

    override func fetchData() {
        print("ä»ç½‘ç»œè¯·æ±‚ç”¨æˆ·æ•°æ®")
    }
}

```

## 3.11 è®¿é—®è€…æ¨¡å¼

å®ƒè®©ä½ å¯ä»¥åœ¨ä¸ä¿®æ”¹å…ƒç´ ç±»çš„å‰æä¸‹ï¼Œ**å‘è¿™äº›ç±»ä¸­æ·»åŠ æ–°çš„æ“ä½œï¼ˆæ–¹æ³•ï¼‰**ã€‚

å®ƒå°†**æ•°æ®ç»“æ„ä¸è¡Œä¸ºæ“ä½œåˆ†ç¦»**ï¼Œå½“ä½ æœ‰ç¨³å®šçš„æ•°æ®ç»“æ„ï¼Œä½†é¢‘ç¹å˜åŠ¨çš„æ“ä½œæ—¶ï¼Œä½¿ç”¨è®¿é—®è€…æ¨¡å¼ç‰¹åˆ«åˆé€‚ã€‚

```swift
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Visitor     â”‚â—„â”€â”€â”€â”€â”€â”‚  ConcreteVisitorA/B â”‚
â””â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Element      â”‚
â”‚+accept(v:Visitor)â”‚
â””â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
 â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
 â”‚ Concrete â”‚
 â”‚ ElementA â”‚
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

ä½ æœ‰å¤šä¸ªå›¾å½¢ç±»ï¼Œæ¯”å¦‚ `Circle`ã€`Rectangle`ï¼Œä½ æƒ³å®ç°å¤šä¸ªè¡Œä¸ºï¼š**ç»˜åˆ¶ã€å¯¼å‡ºã€åˆ†æå¤§å°ç­‰**ï¼Œä½ ä¸å¸Œæœ›æŠŠè¿™äº›è¡Œä¸ºéƒ½å¡è¿›å›¾å½¢ç±»ä¸­ï¼Œè€Œæ˜¯**ç”¨è®¿é—®è€…æ¥å°è£…å®ƒä»¬**ã€‚

```swift
// å®šä¹‰è®¿é—®è€…åè®®ï¼ˆVisitorï¼‰
protocol ShapeVisitor {
    func visit(circle: Circle)
    func visit(rectangle: Rectangle)
}
// å®šä¹‰å›¾å½¢åè®®
protocol Shape {
    func accept(visitor: ShapeVisitor)
}
// å…·ä½“å›¾å½¢ç±»
class Circle: Shape {
    let radius: Double
    
    init(radius: Double) {
        self.radius = radius
    }
    
    func accept(visitor: ShapeVisitor) {
        visitor.visit(circle: self)
    }
}

class Rectangle: Shape {
    let width: Double
    let height: Double
    
    init(width: Double, height: Double) {
        self.width = width
        self.height = height
    }
    
    func accept(visitor: ShapeVisitor) {
        visitor.visit(rectangle: self)
    }
}
// ä¸€ä¸ªè®¿é—®è€…ï¼ˆç»˜å›¾ï¼‰
class DrawVisitor: ShapeVisitor {
    func visit(circle: Circle) {
        print("ç»˜åˆ¶ä¸€ä¸ªåŠå¾„ä¸º \(circle.radius) çš„åœ†")
    }
    
    func visit(rectangle: Rectangle) {
        print("ç»˜åˆ¶ä¸€ä¸ªå®½ \(rectangle.width)ï¼Œé«˜ \(rectangle.height) çš„çŸ©å½¢")
    }
}
// ä½¿ç”¨ç¤ºä¾‹
let shapes: [Shape] = [
    Circle(radius: 10),
    Rectangle(width: 20, height: 15)
]

let drawer = DrawVisitor()

for shape in shapes {
    shape.accept(visitor: drawer)
}
```